<!doctype html>
<html lang="no">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kalkulator for innebanen på Bislett</title>
<style>
  body{
    font-family: monospace;
    background:#f4f0e6;
    color:#111;
    padding:20px;
    max-width:560px;
    margin:auto;
    line-height:1.35;
  }
  h1{font-size:22px; margin:0 0 14px}
  .muted{color:#5a554c; font-size:12px; margin-bottom:18px}
  .tabs{display:flex; gap:10px; margin:12px 0 18px}
  .tab{
    flex:1;
    border:1px solid rgba(0,0,0,.25);
    background:#fff;
    padding:10px;
    cursor:pointer;
    font-family: monospace;
    font-size:14px;
  }
  .tab.active{background:#111; color:#f4f0e6}
  label{display:block; font-size:12px; color:#5a554c; margin:10px 0 6px}
  input{
    width:100%;
    font-size:20px;
    padding:10px;
    font-family: monospace;
    border:1px solid rgba(0,0,0,.25);
    border-radius:10px;
    background:rgba(255,255,255,.65);
  }
  button.main{
    width:100%;
    margin-top:14px;
    font-size:18px;
    padding:12px;
    font-family: monospace;
    border:1px solid rgba(0,0,0,.25);
    border-radius:12px;
    background:#fff;
    cursor:pointer;
  }
  .result{
    margin-top:18px;
    border-top:1px dashed rgba(0,0,0,.35);
    padding-top:14px;
  }
  .big{font-size:30px; margin:8px 0}
  .small{font-size:12px; color:#5a554c}
  .splits{
    margin-top: 14px;
    padding-top: 10px;
    border-top: 1px dashed rgba(0,0,0,.25);
    font-size: 12px;
    white-space: pre;
  }
  .error{
    margin-top:12px;
    padding:10px;
    border:1px solid rgba(150,0,0,.25);
    background:rgba(200,0,0,.06);
    color:#5b0000;
    border-radius:10px;
    display:none;
    font-size:12px;
  }
</style>
</head>
<body>

<h1>Kalkulator for innebanen på Bislett (546,5 m)</h1>
<div class="muted">
  Alle som bruker denne kalkulatoren elsker Dælenenga Cowboys</b>.
</div>

<div class="tabs">
  <button class="tab active" id="tabA" type="button">PACE → TID</button>
  <button class="tab" id="tabB" type="button">TID → PACE</button>
</div>

<label>Antall runder</label>
<input id="laps" value="1" inputmode="numeric" />

<div id="modeA">
  <label>Pace (min/km)</label>
  <input id="pace" value="4:00" placeholder="mm:ss" />
</div>

<div id="modeB" style="display:none;">
  <label>Totaltid (mm:ss eller hh:mm:ss)</label>
  <input id="totalIn" value="2:00" placeholder="mm:ss eller hh:mm:ss" />
</div>

<button class="main" id="calc" type="button">REGN UT</button>

<div class="error" id="err"></div>

<div class="result" id="out" style="display:none;">
  <div class="big" id="line1">—</div>
  <div class="big" id="line2">—</div>
  <div class="small" id="line3">—</div>
  <div class="splits" id="splitsText"></div>
</div>

<script>
const LAP_KM = 0.5465;

const $ = (s) => document.querySelector(s);

const tabA = $("#tabA");
const tabB = $("#tabB");
const modeA = $("#modeA");
const modeB = $("#modeB");

const lapsEl = $("#laps");
const paceEl = $("#pace");
const totalEl = $("#totalIn");

const errEl = $("#err");
const outEl = $("#out");
const line1 = $("#line1");
const line2 = $("#line2");
const line3 = $("#line3");
const splitsText = $("#splitsText");

let currentMode = "A";

function showError(msg){
  errEl.style.display = "block";
  errEl.textContent = msg;
  outEl.style.display = "none";
}

function clearError(){
  errEl.style.display = "none";
}

function parseTimeToSeconds(input){
  const parts = input.trim().split(":");
  if(parts.length === 2){
    return Number(parts[0])*60 + Number(parts[1]);
  }
  if(parts.length === 3){
    return Number(parts[0])*3600 + Number(parts[1])*60 + Number(parts[2]);
  }
  return null;
}

function formatSeconds(sec){
  sec = Math.round(sec);
  const h = Math.floor(sec/3600);
  const m = Math.floor((sec%3600)/60);
  const s = sec%60;
  if(h>0) return `${h}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  return `${m}:${String(s).padStart(2,"0")}`;
}

function formatPace(secPerKm){
  secPerKm = Math.round(secPerKm);
  const m = Math.floor(secPerKm/60);
  const s = secPerKm%60;
  return `${m}:${String(s).padStart(2,"0")}`;
}

function setMode(mode){
  currentMode = mode;
  tabA.classList.toggle("active", mode==="A");
  tabB.classList.toggle("active", mode==="B");
  modeA.style.display = mode==="A" ? "block" : "none";
  modeB.style.display = mode==="B" ? "block" : "none";
  outEl.style.display = "none";
  splitsText.textContent = "";
  clearError();
}

function buildSplits(laps, lapSec){
  let txt = "";
  txt += "Lap | Lap-tid | Total\n";
  txt += "----+---------+---------\n";
  for(let i=1;i<=laps;i++){
    const lap = String(i).padStart(3," ");
    const lt  = formatSeconds(lapSec).padStart(7," ");
    const tot = formatSeconds(lapSec*i).padStart(8," ");
    txt += `${lap} | ${lt} | ${tot}\n`;
  }
  return txt;
}

function calculate(){
  clearError();

  const laps = Number(lapsEl.value);
  if(!Number.isInteger(laps) || laps<=0){
    return showError("Antall runder må være heltall > 0.");
  }

  const distKm = laps * LAP_KM;

  if(currentMode==="A"){
    const paceSec = parseTimeToSeconds(paceEl.value);
    if(!paceSec) return showError("Pace må være mm:ss.");

    const lapSec = paceSec * LAP_KM;
    const totalSec = lapSec * laps;

    line1.textContent = `Runde: ${formatSeconds(lapSec)}`;
    line2.textContent = `Totalt: ${formatSeconds(totalSec)}`;
    line3.textContent = `Distanse: ${distKm.toFixed(3)} km • Pace: ${formatPace(paceSec)} /km`;

    splitsText.textContent = buildSplits(laps, lapSec);
  } else {
    const totalSec = parseTimeToSeconds(totalEl.value);
    if(!totalSec) return showError("Totaltid må være mm:ss eller hh:mm:ss.");

    const paceSec = totalSec / distKm;
    const lapSec = totalSec / laps;

    line1.textContent = `Pace: ${formatPace(paceSec)} /km`;
    line2.textContent = `Runde: ${formatSeconds(lapSec)}`;
    line3.textContent = `Distanse: ${distKm.toFixed(3)} km • Totalt: ${formatSeconds(totalSec)}`;

    splitsText.textContent = "";
  }

  outEl.style.display = "block";
}

tabA.onclick = () => setMode("A");
tabB.onclick = () => setMode("B");
$("#calc").onclick = calculate;
document.addEventListener("keydown", e => { if(e.key==="Enter") calculate(); });

setMode("A");
calculate();
</script>

</body>
</html>
