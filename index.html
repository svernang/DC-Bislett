<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dælenenga Cowboys sin Bislett-kalkulator</title>
  <style>
    :root{
      --paper:#f4f0e6;
      --ink:#1b1b1b;
      --muted:#5a554c;
      --line:#d8cfbf;
      --shadow: 0 18px 50px rgba(0,0,0,.18);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono";
      --serif: ui-serif, "Georgia", "Times New Roman", Times, serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 22px 14px;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(0,0,0,.05), transparent 55%),
        radial-gradient(900px 500px at 80% 40%, rgba(0,0,0,.04), transparent 60%),
        #e9e2d6;
      color: var(--ink);
    }
    .card{
      width: min(720px, 100%);
      background: var(--paper);
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    header{
      padding: 18px 18px 10px;
      border-bottom: 1px dashed rgba(0,0,0,.18);
    }
    h1{
      margin:0;
      font-family: var(--serif);
      font-size: 18px;
      letter-spacing: .4px;
      text-transform: uppercase;
    }
    .sub{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
      font-family: var(--mono);
    }
    .content{padding: 16px 18px 18px}
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 560px){
      .row{grid-template-columns:1fr}
    }
    label{
      display:block;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.18);
      background: rgba(255,255,255,.55);
      font-family: var(--mono);
      font-size: 14px;
      outline:none;
    }
    input:focus{box-shadow: 0 0 0 5px rgba(0,0,0,.08)}
    .btns{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 10px;
      align-items:center;
    }
    button{
      border: 1px solid rgba(0,0,0,.18);
      background: #fff;
      padding: 10px 12px;
      border-radius: 14px;
      font-family: var(--mono);
      cursor:pointer;
    }
    button:active{transform: translateY(1px)}
    .tiny{
      color: var(--muted);
      font-family: var(--mono);
      font-size: 12px;
    }
    .out{
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid var(--line);
      display:grid;
      gap: 10px;
    }
    .big{
      font-family: var(--mono);
      font-size: 28px;
      line-height: 1.1;
      letter-spacing: .5px;
    }
    .k{
      font-family: var(--mono);
      color: var(--muted);
      font-size: 12px;
      margin-top: 2px;
    }
    .receipt{
      margin-top: 8px;
      border-top: 1px dashed rgba(0,0,0,.18);
      padding-top: 10px;
      font-family: var(--mono);
      font-size: 12px;
      white-space: pre;
      color: var(--ink);
    }
    .error{
      display:none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(150,0,0,.25);
      background: rgba(200,0,0,.06);
      color: #5b0000;
      font-family: var(--mono);
      font-size: 12px;
    }
    footer{
      padding: 12px 18px;
      border-top: 1px dashed rgba(0,0,0,.18);
      display:flex;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      font-family: var(--mono);
      font-size: 11px;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <main class="card">
    <header>
      <h1>Dælenenga Cowboys er bedre enn ABC</h1>
      <p class="sub">Bruk vår kalkulator til å regne ut hvilke rundetider du må ha for å treffe på ønsket pace.</p>
    </header>

    <section class="content">
      <div class="row">
        <div>
          <label>Antall runder</label>
          <input id="laps" inputmode="numeric" value="8" />
        </div>
        <div>
          <label>Pace (min/km)</label>
          <input id="pace" value="4:15" placeholder="mm:ss (f.eks. 4:15)" />
        </div>
      </div>

      <div class="btns">
        <button id="calc">Regn ut</button>
        <button id="copy">Kopier</button>
        <button id="reset">Reset</button>
        <span class="tiny">Enter = regn ut</span>
      </div>

      <div class="error" id="err"></div>

      <div class="out" id="out" style="display:none;">
        <div>
          <div class="big" id="lapTime">—</div>
          <div class="k">tid per runde</div>
        </div>
        <div>
          <div class="big" id="totalTime">—</div>
          <div class="k">totaltid</div>
        </div>

        <div class="receipt" id="receipt"></div>
      </div>
    </section>

    <footer>
      <div>Tips: pace kan være <b>mm:ss</b> eller <b>4.25</b> (minutter)</div>
      <div id="meta">Klar</div>
    </footer>
  </main>

  <script>
    const LAP_KM = 0.5465;

    const $ = (s) => document.querySelector(s);
    const lapsEl = $("#laps");
    const paceEl = $("#pace");
    const outEl = $("#out");
    const errEl = $("#err");
    const metaEl = $("#meta");

    const lapTimeEl = $("#lapTime");
    const totalTimeEl = $("#totalTime");
    const receiptEl = $("#receipt");

    function setMeta(msg){
      metaEl.textContent = msg;
      clearTimeout(setMeta._t);
      setMeta._t = setTimeout(() => metaEl.textContent = "Klar", 1400);
    }

    function parsePaceToSecondsPerKm(input){
      const s = (input || "").trim().replace(",", ".");
      if (!s) return null;

      if (s.includes(":")){
        const [mmRaw, ssRaw] = s.split(":");
        const mm = Number(mmRaw), ss = Number(ssRaw);
        if (!Number.isFinite(mm) || !Number.isFinite(ss) || mm < 0 || ss < 0 || ss >= 60) return null;
        return mm * 60 + ss;
      }

      const minutes = Number(s);
      if (!Number.isFinite(minutes) || minutes <= 0) return null;
      return minutes * 60;
    }

    function fmt(sec){
      const s = Math.round(sec);
      const mm = Math.floor(s / 60);
      const ss = s % 60;
      return `${mm}:${String(ss).padStart(2,"0")}`;
    }

    function showError(msg){
      errEl.style.display = "block";
      errEl.textContent = msg;
      outEl.style.display = "none";
    }

    function clearError(){
      errEl.style.display = "none";
      errEl.textContent = "";
    }

    function buildReceipt(laps, lapSec){
      const totalSec = lapSec * laps;
      const distKm = laps * LAP_KM;

      let lines = "";
      lines += "— SPLITS —\n";
      lines += `Runder: ${laps}\n`;
      lines += `Distanse: ${distKm.toFixed(3)} km\n`;
      lines += `Rundetid: ${fmt(lapSec)}\n`;
      lines += `Totalt: ${fmt(totalSec)}\n`;
      lines += "-------------------------\n";
      lines += "Lap  |  Lap-tid |  Total\n";

      for (let i = 1; i <= laps; i++){
        const lap = String(i).padStart(3," ");
        const lt  = fmt(lapSec).padStart(7," ");
        const tot = fmt(i * lapSec).padStart(7," ");
        lines += `${lap}  |  ${lt}  |  ${tot}\n`;
      }
      return lines.trimEnd();
    }

    function calculate(){
      clearError();

      const laps = Number(String(lapsEl.value).trim());
      if (!Number.isInteger(laps) || laps <= 0) return showError("Antall runder må være et heltall > 0.");

      const paceSecPerKm = parsePaceToSecondsPerKm(paceEl.value);
      if (!Number.isFinite(paceSecPerKm) || paceSecPerKm <= 0) return showError("Pace må være mm:ss (f.eks. 4:15) eller 4.25 (minutter).");

      const lapSec = paceSecPerKm * LAP_KM;
      const totalSec = lapSec * laps;

      lapTimeEl.textContent = fmt(lapSec);
      totalTimeEl.textContent = fmt(totalSec);

      receiptEl.textContent = buildReceipt(laps, lapSec);
      outEl.style.display = "grid";

      setMeta("Oppdatert");
    }

    async function copy(){
      if (outEl.style.display === "none") calculate();
      if (outEl.style.display === "none") return;

      const txt = receiptEl.textContent;
      try{
        await navigator.clipboard.writeText(txt);
        setMeta("Kopiert");
      } catch {
        window.prompt("Kopier manuelt:", txt);
      }
    }

    function reset(){
      lapsEl.value = 8;
      paceEl.value = "4:15";
      outEl.style.display = "none";
      clearError();
      setMeta("Reset");
      lapsEl.focus();
    }

    $("#calc").addEventListener("click", calculate);
    $("#copy").addEventListener("click", copy);
    $("#reset").addEventListener("click", reset);

    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter") calculate();
    });

    // initial
    calculate();
  </script>
</body>
</html>